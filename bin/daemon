#!/usr/bin/env node
'use strict';

var sensor = require('../sensor');
var config = require('../config');
var reporter = require('../reporter');
var server = require('../server').createServer();

reporter.init(config.reporter);


//Server: We should be able to change configuration on
//GUI/Client and then reboot app.
server.start();
server.on('server.ready', function(){
    /*
     * Sensor uses app to publish events.
     */
    sensor.init(server, config.sensor);
});

server.on('sensor.event', function(event){
    console.warn('sensor.event', event);
    reporter.buffer([
        {
            event: event.type,
            value: event.value
        },
        {
            id: event.id,
            building: config.building,
            floor: config.floor,
            type: config.type || 'phonebooth'
        }
    ]);
});
